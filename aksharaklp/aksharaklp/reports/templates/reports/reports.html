<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <link rel="icon" href="/static/images/favicon.ico" />
    <title>Community Feedback</title>
    <!-- Bootstrap core CSS -->
    <link href="../../static/lib/tipsy.css" rel="stylesheet">
    <link href="../../static/lib/bootstrap.min.css" rel="stylesheet"/>
    <link href="../../static/lib/datepicker.css" rel="stylesheet"/>
    <link href="../../static/lib/Style.css" rel="stylesheet"/>
<!--     <link rel="stylesheet" href="https://klp.org.in/static/css/style.css" type="text/css" media="all"/>
 -->    
    <link href="../../static/css/dashboard.css" rel="stylesheet"/>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
   <header class="main-header  ">
       <div class="header-content">
           <a href="/" class="header_mobile_logo"></a>
           <a class="mobile_icon" onclick="toggle_mobile_nav();"></a>
           <nav class="top-nav" role="navigation">
               <ul id="navigation">
                   <li class="home">
                       <a href="/">
                           <h1>Karnataka Learning Partnership</h1>
                       </a>
                   </li>
                   <li class="school_map">
                       <a href="https://klp.org.in/map/" title="">School Map</a>
                   </li>
                   <li class="programmes">
                       <a href="https://klp.org.in/programmes/reading/" title="">Programmes</a>
                       <ul style="display: none;">
                           <li><a href="https://klp.org.in/programmes/reading/" title=""><span></span>Akshara</a>
                           </li>
                           <li><a href="https://klp.org.in/programmes/sikshana/" title=""><span></span>Sikshana</a>
                           </li>
                       </ul>
                   </li>
                   <li class="volunteer phn-tab-hide">
                       <!-- REFER to dubdubdub-skin template before adding donate link -->
                       <a href="https://klp.org.in/volunteer/" title="">Volunteer</a>
                   </li>

                   <li class="volunteer hide phn-tab-block">
                       <a href="https://klp.org.in/volunteer.php" title="">Volunteer</a>
                   </li>

                   <li class="database">
                       <a href="/listFiles/2" title="">Data</a>
                       <ul>
                           <li><a href="http://status.klp.org.in" target="_blank" title=""><span></span>Status</a>
                           </li>
                           <li><a href="https://klp.org.in/data" title=""><span></span>Data</a>
                           </li>
                           <li><a href="http://github.com/klpdotorg" target="_blank" title=""><span></span>Code</a>
                           </li>
                       </ul>
                   </li>
                   <li class="reports">
                       <a href="https://klp.org.in/reports" title="">Reports</a>
                       <ul>
                           <li><a href="http://dise.klp.org.in" target="_blank" title=""><span></span>DISE</a>
                           </li>
                           <li><a href="http://reports.klp.org.in" target="_blank" title=""><span></span>KLP Reports</a>
                           </li>
                           <li><a href="http://sslc.klp.org.in" target="_blank" title=""><span></span>SSLC</a>
                           </li>
                           <li><a href="http://ivrs.klp.org.in/" target="_blank" title=""><span></span>IVRS</a>
                           </li>
                           <li><a href="/text/reports" title=""><span></span>Other Reports</a>
                           </li>
                       </ul>
                   </li>
                   <li class="about">
                       <a href="https://klp.org.in/about/" title="">About</a>
                       <ul>
                           <li><a href="https://klp.org.in/about/" title=""><span></span>About</a>
                           </li>
                           <li><a href="https://klp.org.in/partners/" title=""><span></span>Partners</a>
                           </li>
                           <li><a href="https://klp.org.in/disclaimer/" title=""><span></span>Disclaimer</a>
                           </li>
                       </ul>
                   </li>
               </ul>
           </nav>
           <div class="clr"></div>
       </div>
       
       <div class="subheader-wrapper">
           <div class="subheader-content">
               <div class="breadcrumb fl">
                   <a href="/">Home</a>
                   <span></span>
                   <a href="/">Reports</a>
               </div>
               <div class="clr"></div>
           </div>
       </div>
   </header>
   <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="page-status">
              <div class="page-section-heading-with-menu container-menu">
               <div class="options-wrapper">
                <div class="option_item options-container">
                  <div class="options_toggle"> 
                    <span class="label">District</span> 
                    <span class="value"></span> 
                  </div>
                  <div class="item_values">
                    <ul id="dSelect">
                    </ul>
                  </div>
                </div>
                <div class="option_item options-container">
                  <div class="options_toggle"> 
                    <span class="label">Block</span> 
                    <span class="value"></span>
                  </div>
                  <div class="item_values">
                    <ul id="bSelect">
                    </ul>
                  </div>
                </div>
                <div class="option_item options-container">
                  <div class="options_toggle"> 
                    <span class="label">Cluster</span> 
                    <span class="value"></span> 
                  </div>
                  <div class="item_values">
                    <ul id="cSelect">
                    </ul>
                  </div>
                </div>
                <div class="option_item options-container">
                  <div class="options_toggle"> 
                    <span class="label">School</span> 
                    <span class="value"></span> 
                  </div>
                  <div class="item_values">
                    <ul id="sSelect">
                    </ul>
                  </div>
                </div>
                <div class="option_item options-container">
                  <div style="background-image:none;"> <span class="label">From</span>
                    <input id="fromDatePicker" type="text" readonly="readonly" class="date-input" style="cursor:pointer"> </div>
                </div>
                <div class="option_item options-container">
                  <div style="background-image:none;"> <span class="label">To</span>
                    <input id="toDatePicker" type="text" readonly="readonly" class="date-input" style="cursor:pointer"> </div>
                </div>
                <div class="option_item" style="border:none;">
                  <div style="background-image:none;  text-align:center;padding-bottom: 0px;">
                    <button id="submitBtn" class="button" style="margin: 0px; border-bottom-width: 10px;" onclick="refreshCharts()"><span class="glyphicon glyphicon-refresh"></span>
                    </button>
                  </div>
                </div>
               </div>
              </div>
            </div>
            <div class="tabs">
                <ul class="tabs-nav">
                   <li data-tab="performanceDiv" class="current">Performance Index</li>
                    <li data-tab="requirementsDiv">Requirements Metrics</li>
                     <li data-tab="methodologyDiv" class="right-aligned">Methodology</li>
                </ul>
                <div id="performanceDiv" class="tabs-content current">
                  <div class="container-fluid">
                      <div class="row">
                          <div class="col-md-12">
                              <h5>Performance Index Of Parents, SDMC, Community Members And Teachers Based On The Feeddback Survey</h5>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-12">
                              <div style="height:500px">
                                  <svg id="perfIndChart" style="width:100%;height:100%"></svg>
                              </div>
                          </div>
                      </div>
                  </div>
                </div>
                <div id="requirementsDiv" class="tabs-content">
                  <div class="container-fluid padded-container">
                      <div class="row">
                          <div class="col-md-12">
                              <h5 class="heading">Requirements Of Parents, SDMC, Community Members And Teachers Based On The Feeddback Survey</h5>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-12">
                              <div style="height:300px">
                                  <svg id="reqAvgChart" style="width:100%;height:100%">
                                  </svg>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-12">
                              <h5 id="selectedSHName" class="heading"></h5>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-12">
                              <div style="height:300px">
                                  <svg id="reqAvgBreakdownChart" style="width:100%;height:100%">
                                  </svg>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-12">
                              <div style="height:200px">
                                  <svg id="reqAvgBreakdownLegend" style="width:100%;height:100%">
                                  </svg>
                              </div>
                          </div>
                      </div>
                  </div>
                </div>
                <div id="methodologyDiv" class="tabs-content">
                  <div class="container">
                    <section id="section_overview">
                        <div class="page-section-heading">
                            <div class="container">
                                <div class="heading">
                            <h2>COMMUNITY FEEDBACK ANALYSIS - OUR JOURNEY</h2>
                          </div>
                            </div>
                        </div>
                        <div class="container">       
                        <p>We all become philanthropists at some point in our lives and we have the innate need to help those who are in need. But what we fail to understand is that the help which was rendered might not be the help which was required in the first place. </p>
                            <p>There is a huge gap between the Helping hand and the hand which needs help. 
                        This dashboard tries to highlight the needs of the stakeholders who play a key role in the performance of their local government schools. The intention behind this is to direct all the goodwill towards the actual problem, in order to find a solution which would be sustaining in the long run.</p>
                        </div>
                    </section>
                    <section id="section_overview">
                        <div class="page-section-heading">
                            <div class="container">
                                <div class="heading">
                                    <h2>BACKGROUND</h2>
                                </div>
                            </div>
                        </div>
                        <div class="container">             
                            <p>We started off with a bunch of sheets which carried valuable information pertaining to the problems faced in government schools. The field staffs of Akshara during their regular visits to the schools try to understand the problems and drawbacks faced by the schools from the local community. </p>
                            <p>They come back to their office and write down these issues faced by the teachers, parents, community members and SDMC (Student Development Monitoring Committee) members on a piece of paper.</p>
                            <p>The write ups were in Kannada and these were unstructured as each field staff has his/her own flare of writing. But it captured the essence of the problem in each school. It was very important to highlight these issues in a forum wherein people would be able to come forth and provide solutions. </p>
                            <p>Ashok and Gautam of Akshara Foundation wanted to present this data in a form of a dashboard and deploy it on their Karnataka Learning Partnership website so that the problems are highlighted to the general public and political personnel. The dashboard design had to incorporate two aspects, the performance and the requirements of the key stakeholders.</p>
                            <p>Even though the write ups were valuable, they were unstructured and there was a need to bring in some form of uniformity in the data collection process.  So our initial hurdle was the conversion of text from regional language to English. Once this was done, we found the frequency of similar problems within the sheets of data. Around 1000 sheets were considered for this exercise.</p>
                            <p>With the key problem areas highlighted, we designed a feedback template which asked the relevant questions and captured the replies in binary format. The template also incorporated fields to recognize other issues with the school, so that this could be incorporated in the future within the template, if its occurrence was prominent like the rest.</p>
                            <p>The template had one section to collect information regarding the performance of the key stakeholders from the community which included them as well. For example, there is question in the template which asks "Are the teachers involved in the progress of the school?"  Now this question is answered by Teachers, Parents and the community members who make up the locality.</p>
                            <p>The other section brings out the requirements which the teachers, parents and community members need to make their school fair better. This is the section which calls for action from the authority and public.
                            So this template was rolled out and we started receiving data from 3 regions (at present). The data coming in is collated and rolled up to project the performance and requirements of the key stakeholders.</p>
                        </div>
                    </section>
                    <section id="section_overview">
                        <div class="page-section-heading">
                            <div class="container">
                                <div class="heading">
                                    <h2>METHODOLOGY</h2>
                                </div>
                            </div>
                        </div>
                        <div class="container">             
                           <h2>Performance Calibration</h2>
                           <p>Here we are asking the Parents, Teachers and Community members about the involvement of themselves and the government monitoring committee which comprises of them and the Village heads/Panchayat leaders. So it is very important to understand the agreement proportion for each category.</p>
                           <p>Hence we have a derived metric in place which calls out the <b>assumed actual response</b> for each question from the responses of all the key stakeholders. This derived metric is then matched with the actual response of the stakeholders. The matched response for each of the stakeholder is rolled up to determine the agreement percentage to determine the performance of a particular stakeholder. The agreement percentage is then normalized for the entire data. This normalized agreement percentage becomes the weights to the responses coming in from the stakeholders regarding the performance of teachers, parents or community members.</p>
                           <p>The data is rolled up to a school ID – month- year level to calibrate a score to quantify the performance of the stakeholders in the region of selection.</p>

                           <h2>Requirements Estimation</h2>
                           <p>The teachers, parents and community members have 4 requirements called out for each based on the initial Data analysis. A particular stakeholder is said to be well equipped for only a particular combination of binary replies. This is also rolled up at a school ID – month- year level to see a trend in the requirements and to pin point at a reason which is hindering their performance.</p>
                           <p>For example the current dataset shows that a maximum of 2% of parents population are satisfied with the quality of mid-day meal served at school. So there needs to be an immediate action to be taken on this front as a large population of parents has expressed their dissent towards the food served.</p>
                        </div>
                    </section>
                    <section id="section_overview">
                        <div class="page-section-heading">
                            <div class="container">
                                <div class="heading">
                                    <h2>DATA INTERPRETATION</h2>
                                </div>
                            </div>
                        </div>
                        <div class="container">             
                           <p>We have two tabs which call out the performance and requirements of the stakeholders separately.</p>
                           <p>The first tab which is the Performance, shows a trend chart indicating how the performance of teachers, parents, community members and SDMC have fared over the months.</p>
                           <p>The UI has drop downs to select the desired district, block, cluster and school. The drop downs roll up the data to the level of choice. It also has a calendar where the duration from and to month can be selected to see the trend. Each line in the chart basically shows the trend in which a particular stakeholder is performing in the duration selected. </p>
                           <p>The second tab which is the Requirements tab, projects data for the selections made in the performance tab. This shows how well equipped the parents, teachers and community members are across months and highlights the percentage of satisfaction for each of the requirement.</p>
                           <p>This tab will be projecting data for the selections made in the <b>performance</b> tab. The first chart is a trend chart. This chart shows the trend of how well equipped the stakeholders are for the level of data selected.  If there is a negative score assigned, then it means that the stakeholder is not well equipped and the needs of this stakeholder will be highlighted in the chart which follows. This bar chart calls out the percentage of satisfaction across the 4 requirements for that particular stakeholder. Thus narrowing down the cause and paving a thought process to find a solution to the need.</p>
                        </div>
                    </section>
                  </div>
                </div>
            </div>
          </div>
        </div>
   </div>
   <footer class="main-footer footer">
        <div class="footer-wrapper">
          <nav class="nav">
            <ul>
              <li><a href="/about/" title="">About</a></li>
              <li><a href="mailto:team@klp.org.in" title="">Contact</a></li>
              <li class="hidden-phone hidden-tablet"><a href="http://www.facebook.com/klpdotorg" target="_blank">Facebook</a></li>
              <li class="hidden-phone hidden-tablet"><a href="https://twitter.com/KLPsays" target="_blank">Twitter</a></li>
              <li class="hidden-phone hidden-tablet"><a href="http://blog.klp.org.in/feeds/posts/default" target="_blank">RSS Feed</a></li>
              <li class="hidden-phone hidden-tablet"><a href="http://www.youtube.com/user/klpdotorg" target="_blank">You Tube</a></li>
              <li class="hidden-phone hidden-tablet"><a href="/map" title="">School Map</a></li>
             <li style="width: 25%; float: right;">
                 <table style="float: right;">
                   <tbody>
                   <tr>
                     <th style="text-align:center;">
                       <a href="http://www.mu-sigma.com">
                       <img src="../../static/images/mu-sigma-logo.png" alt="Powered By: Mu-Sigma Inc."border="0">
                       </a>
                     </th>
                   </tr>
                 </tbody></table>
            </li>
               <div class="clr"></div>
               <div class="clr"></div>
            </ul>
        </nav>
        <div class="copyright">Copyright 2013. All Rights Reserved.</div>
        </div>
   </footer>
    <!-- Bootstrap core JavaScript
      ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../static/lib/jquery-min.js"></script>
    <script src="../../static/lib/jquery.tipsy.js"></script>
    <script src="../../static/lib/bootstrap.min.js"></script>
    <script src="../../static/lib/bootstrap-datepicker.js"></script>
    <script src="../../static/lib/d3.min.js"></script>
    <script type="text/javascript">
        var locationData = {% autoescape off %}{{ locationData }}{% endautoescape %};
        var fromDate = new Date('{% autoescape off %}  {{ fromDate }} {% endautoescape %}');
        var toDate = new Date('{% autoescape off %}  {{ toDate }} {% endautoescape %}');

        var district, block, cluster, school;
        var reqBasicData, avgsSplitData, perfData;

        var linesPalette = ['#EC6608', '#8E8CA5', '#6398E5', '#2C3E50'];
        var barsPalette = ['#3891E3', '#24B2B6', '#7575BC', '#CB0012'];

        var drawPending = true;

        var margin = {
            top: +10,
            right: +70,
            left: +60,
            bottom: +40
        };
         //tips
         //defines a function to be used to append the title to the tooltip.  you can set how you want it to display here.
        var maketip = function (d) {
            var tip = "(" + Math.round(+d.value * 1000) / 1000 + " , " + parseDate(d.date) + ")";
            return tip;
        };

         //parse date
        var parseDate = d3.time.format("%b %y");

         //palette
        var barColors = d3.scale.ordinal().range(barsPalette);
        var lineColors = d3.scale.ordinal().range(linesPalette);

        var reqSplitLegendData = {
            Teachers: [{
                name: 'split1',
                value: 'TLM (Teaching learning material) Sufficient'
            }, {
                name: 'split2',
                value: 'Overloaded with work'
            }, {
                name: 'split3',
                value: 'Need retraining/extra classes'
            }, {
                name: 'split4',
                value: 'Healthy relationship with the board'
            }],
            Parents: [{
                    name: 'split1',
                    value: 'School Board running the school efficiently'
                }, {
                    name: 'split2',
                    value: 'Teachers are consistent and take classes regularly'
                },
                {
                    name: 'split3',
                    value: 'Children getting required attention in school'
                }, {
                    name: 'split4',
                    value: 'Concern pertaining to the food served in school'
                }],
            Community: [{
                    name: 'split1',
                    value: 'Teachers qualified/trained or motivated'
                }, {
                    name: 'split2',
                    value: 'Student-Teacher ratio is high'
                },
                {
                    name: 'split3',
                    value: "Government involved in school's development"
                }, {
                    name: 'split4',
                    value: 'Is the school in a safe location and is the infrastructure good?'
                }]
        };

        $(document).ready(function(){
            setDateDropDowns();
            $()
            // Tabs handler
            $('.tabs ul.tabs-nav li').click(function(e){
                var tab_id = $(this).attr('data-tab');

                $('.tabs ul.tabs-nav li').removeClass('current');
                $('.tabs .tabs-content').removeClass('current');

                $(this).addClass('current');
                $("#"+tab_id).addClass('current');

                if (drawPending === true) {
                    if (tab_id == "requirementsDiv")
                        drawReqChart();
                    else
                        drawPerformanceIndex();
                }
                drawPending = false;
            });

            $('.options_toggle').on('click',function(e){
              var target=e.target;
              var state_open = false;
              var dropdown=$(target).parents('.option_item').find('.item_values');
              if(dropdown.hasClass('open')){
                state_open = true;
              }
              $('.item_values').removeClass('open');
              if(state_open){
                $(dropdown).removeClass('open');
              } else {
                $(dropdown).addClass('open');
              }
              e.stopPropagation();
            });

            for (var key in locationData) {
                locationData[key] = JSON.parse(locationData[key]);
                var data = $.extend(true, {}, locationData[key][0]);
                data.pk = 0;
                for (name in data.fields) {
                    if (name.search('name') != -1)
                        data.fields[name] = "All"
                    else data.fields[name] = 0
                }
                locationData[key].unshift(data);
            }
            
            setLocationData(0);
                
            $('#submitBtn').trigger('click');
        });

        function setLocationData(pk) {
            var selectedValue = {
                pk: pk
            };
            onSelect("dSelect", locationData.districts, null, "district_name", selectedValue, onDistrictSelect);
        }

        function onDistrictSelect(selectedValue) {
            district = selectedValue.data.pk;
            onSelect("bSelect", locationData.blocks, "district", "block_name", district, onBlockSelect);
        }

        function onBlockSelect(selectedValue) {
            block = selectedValue.data.pk;
            onSelect("cSelect", locationData.clusters, "block", "cluster_name", block, onClusterSelect);
        }

        function onClusterSelect(selectedValue) {
            cluster = selectedValue.data.pk;
            onSelect("sSelect", locationData.schools, "cluster", "school_name", cluster, onSchoolSelect);
        }

        function onSchoolSelect(selectedValue) {
            school = selectedValue.data.pk;
        }

        function onSelect(dropdownId, rawData, filterKey, dataField, key, eventListener) {
            $('#' + dropdownId).empty();

            var filteredData, selDistIndex;
            if (filterKey != null) {
                filteredData = $.grep(rawData, function (el, index) {
                    var value = (el.fields[filterKey] != null) ? el.fields[filterKey] : el[filterKey];
                    return value == key || value == 0;
                });
            } else {
                filteredData = rawData;
            }

            selDistIndex = 0;

            var selAnchor;

            $.each(filteredData, function (index, value) {
                var selText = toProperCase(value.fields[dataField]);
                var anchor = $('<a>')
                    .attr('href', 'javascript:void(0)')
                    .append(selText)
                    .click(value, eventListener)
                    .click(function (event) {
                       var target = event.target;
                       $(target).parents('.option_item')
                                .children('.options_toggle')
                                .children('.value')
                                .text($(target).text());
                       $(target).parents('.item_values').removeClass('open')
                    })
                    .data(value);

                var createdList = $('#' + dropdownId)
                    .append($('<li>')
                        .append($(anchor)));
                selAnchor = (selDistIndex == index) ? anchor : selAnchor;
            });

            $(selAnchor)
                .trigger('click');
        }

        function setDateDropDowns() {
            $('#fromDatePicker').datepicker({
                format: "MM - yyyy",
                minViewMode: 1,
                autoclose: true
            });
            $('#toDatePicker').datepicker({
                format: "MM - yyyy",
                minViewMode: 1,
                autoclose: true
            });
            $('#fromDatePicker').datepicker("setDate", new Date(fromDate));
            $('#toDatePicker').datepicker("setDate", new Date(toDate));
        }

         //Chart Functions
         //generate data
        function refreshCharts() {
            fromDate = $("#fromDatePicker").datepicker('getDate');
            toDate = $("#toDatePicker").datepicker('getDate');
            //database month is 1 to 12 / javascript is 0 to 11
            var fromMonth = fromDate.getMonth() + 1;
            var toMonth = toDate.getMonth() + 1;
            var fromYear = fromDate.getFullYear();
            var toYear = toDate.getFullYear();

            var data = {
                fromMonth: fromMonth,
                fromYear: fromYear,
                toMonth: toMonth,
                toYear: toYear,
                district: district,
                block: block,
                cluster: cluster,
                school: school
            };

            var rData;

            $.get('../generate', data, function (data) {
                rData = data;
            })
            .done(function () {
                    rData = JSON.parse(rData);
                    reqBasicData = d3.csv.parse(rData.reqData, function (d) {
                        d.date = d.date.split('-');
                        return {
                            date: new Date(d.date[1], d.date[0] - 1),
                            Teachers: +d.Teachers,
                            Parents: +d.Parents,
                            Community: +d.Community
                        };
                    });

                    avgsSplitData = d3.csv.parse(rData.reqAvgsSplit, function (d) {
                        d.date = d.date.split('-');
                        return {
                            date: new Date(d.date[1], d.date[0] - 1),
                            splitOf: d.splitOf,
                            split1: +d.split1,
                            split2: +d.split2,
                            split3: +d.split3,
                            split4: +d.split4
                        };
                    });

                    perfData = d3.csv.parse(rData.perfData, function (d) {
                        d.date = d.date.split('-');
                        return {
                            date: new Date(d.date[1], d.date[0] - 1),
                            Teachers: +d.Teachers,
                            SDMC: +d.SDMC,
                            Community: +d.Community,
                            Parents: +d.Parents
                        };
                    });

                    //set refresh boolean
                    drawPending = true;
                    if ($(".tabs div.current").attr('id') == "requirementsDiv") {
                        drawReqChart();
                        scrollToDiv("body");
                    } else
                        drawPerformanceIndex();
                })
                .fail(function () {
                    console.log('request failed')
                });
        }

        function drawReqChart() {
            drawLineChart("reqAvgChart", reqBasicData, "Months", "Requirements Metric",true);
            var svg = d3.select("#reqAvgChart");
            var clickHandler = function (data) {
                var text="Percentage of "+data.name+" satisfied across the 4 requirements"
                $('#selectedSHName').text(text);
                drawReqSplitsChart(data.name);
                scrollToDiv('#selectedSHName');
            };

            var lines = svg.selectAll('.line');
            lines.on('click', clickHandler);

            var circles = svg.selectAll('.datapoint');
            circles.on('click', clickHandler);

            drawReqSplitsChart();
        }

        function drawReqSplitsChart(splitOf) {
            splitOf = (splitOf != null) ? splitOf : "Teachers";
            var height = +$("#reqAvgChart").height();
            var width = +$("#reqAvgChart").width();
            var heightDiff = height - margin.top - margin.bottom;
            var widthDiff = width - margin.right - margin.left - 100;
            var padding = .5,
                outerPadding = 0;

            //filter data
            var dataset = avgsSplitData;
            dataset = dataset.filter(function (datum) {
                return (datum.splitOf == splitOf)
            });

            //date axis      
            var dateScale = d3.scale.ordinal().rangeRoundBands([0, widthDiff], padding, outerPadding);
            var splitScale = d3.scale.ordinal();
            var yScale = d3.scale.linear().range([heightDiff, 0]);

            var xAxis = d3.svg.axis()
                .scale(dateScale)
                .orient("bottom")
                .tickFormat(d3.time.format("%b %y"))

            var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left");

            var svg = d3.select("#reqAvgBreakdownChart");

            var yLabel = svg.selectAll('.yLabel');
            if (yLabel.empty())
                svg.append('text')
                .attr("class", "yLabel axisLabels")
                .text("Requirement Metric(%)")
                .attr('transform', 'translate(' + (+margin.left / 5) + ',' + (+heightDiff) + ') rotate(-90)');


            var xLabel = svg.selectAll('.xLabel');
            if (xLabel.empty())
                svg.append('text')
                .attr("class", "xLabel axisLabels")
                .text("Months")
                .attr('transform', 'translate(' + (+widthDiff + 100) + ',' + (+height - margin.bottom) + ')');

            var splits = d3.keys(dataset[0])
                .filter(function (key) {
                    return key !== 'splitOf' && key !== 'date' && key != 'splitData';
                });

            barColors.domain(splits);
            dataset.forEach(function (d, i) {
                d.splitData = splits.map(function (name) {
                    return {
                        name: name,
                        value: +d[name]
                    };
                });
            });

            var totalMonths = (fromDate.getFullYear() - toDate.getFullYear()) * 12 + (toDate.getMonth() - fromDate.getMonth());
            var months = (totalMonths == 0) ? d3.time.months(fromDate, toDate) : d3.time.months(fromDate, d3.time.month.offset(toDate, 1));

            dateScale.domain(months);
            splitScale.domain(splits).rangeRoundBands([0, dateScale.rangeBand()]);

            yScale.domain([d3.min(dataset, function (d) {
                    return d3.min(d.splitData, function (d) {
                        return d.value;
                    });
                }),
                   d3.max(dataset, function (d) {
                    return d3.max(d.splitData, function (d) {
                        return d.value;
                    });
                })]);

            var xAxisGroup = svg.select(".x.axis");
            if (xAxisGroup.empty()) {
                xAxisGroup = svg.append("g").attr("class", "x axis")
                    .attr("transform", "translate(" + margin.left + "," + (+margin.top + heightDiff) + ")")
            }
            xAxisGroup.call(xAxis);

            var yAxisGroup = svg.select(".y.axis");
            if (yAxisGroup.empty()) {
                yAxisGroup = svg.append("g")
                    .attr("class", "y axis")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            }
            yAxisGroup.call(yAxis);

            var perfSplit = svg.selectAll(".PerfSplit").data(dataset);

            perfSplit.exit().remove();

            perfSplit.enter()
                .append("g")
                .attr("class", "PerfSplit")
                .attr("transform", function (d) {
                    return "translate(" +
                        dateScale(d.date) + ",0)";
                });

            perfSplit.attr("class", "PerfSplit")
                .attr("transform", function (d) {
                    return "translate(" +
                        dateScale(d.date) + ",0)";
                });

            var rects = perfSplit.selectAll(".bar").data(function (d) {
                return d.splitData;
            });

            rects.exit().remove();

            rects.enter()
                .append("svg:rect")
                .attr("class", "bar")
                .attr("width", splitScale.rangeBand())
                .attr("height", function (d) {
                    return heightDiff - yScale(d.value);
                })
                .attr("y", function (d) {
                    return yScale(d.value)
                })
                .attr("x", function (d) {
                    return splitScale(d.name);
                })
                .style("fill", function (d) {
                    return barColors(d.name);
                })
                .attr("transform", function (d) {
                    return "translate(" + margin.left + "," + (+margin.top) + ")";
                });

            rects.attr("width", splitScale.rangeBand())
                .attr("height", function (d) {
                    return heightDiff - yScale(d.value);
                })
                .attr("x", function (d) {
                    return splitScale(d.name);
                })
                .attr("y", function (d) {
                    return yScale(d.value)
                })
                .style("fill", function (d) {
                    return barColors(d.name);
                })
                .attr("transform", function (d) {
                    return "translate(" + margin.left + "," + margin.top + ")";
                });


            var leftMargin = splitScale.rangeBand() / 2 + margin.left;

            var tipsFunction = function (d) {
                return Math.round(d.value * 1000) / 1000
            };

            var circles = perfSplit.selectAll('.trendPoint').data(function (d) {
                return d.splitData
            });

            circles.enter().append('svg:circle')
                .attr('class', 'trendPoint')
                .attr('cy', function (d) {
                    return yScale(d.value);
                })
                .attr('cx', function (d) {
                    return splitScale(d.name);
                })
                .attr('r', 2)
                .attr('title', tipsFunction)
                .attr("transform", function (d) {
                    return "translate(" + leftMargin + "," + margin.top + ")";
                })

            circles.attr('cy', function (d) {
                return yScale(d.value);
            })
                .attr('cx', function (d) {
                    return splitScale(d.name);
                })
                .attr('r', 3)
                .attr('title', tipsFunction)
                .attr("transform", function (d) {
                    return "translate(" + leftMargin + "," + margin.top + ")";
                })

            circles.exit().remove();

            $('.trendPoint').tipsy({
                opacity: .9,
                gravity: 'w'
            });

            var line = d3.svg.line().x(function (d) {
                    return splitScale(d.name);
                })
                .y(function (d) {
                    return yScale(d.value);
                });

            var lines = perfSplit.selectAll(".trendLine").data(function (d) {
                return [d]
            });

            lines.enter().append("svg:path")
                .attr("class", "trendLine")
                .attr("d", function (d) {
                    return line(d.splitData);
                })
                .attr('transform', 'translate(' + leftMargin + ',' + margin.top + ')')
                .on('mouseover', function (event) {
                    var bars = $('.bar');
                    d3.selectAll(bars).style("opacity", 0.2);
                })
                .on('mouseout', function (event) {
                    var bars = $('.bar');
                    d3.selectAll(bars).style("opacity", 1);
                });
            lines.attr("d", function (d) {
                return line(d.splitData);
            }).attr('transform', 'translate(' + leftMargin + ',' + margin.top + ')');

            lines.exit().remove();

            var legendScale = d3.scale.ordinal().range([25, 50, 75, 100]).domain(splits);

            var legendSvg = d3.select('#reqAvgBreakdownLegend');

            var legendParts = legendSvg.selectAll('.legendParts').data(reqSplitLegendData[splitOf]);

            legendParts.enter()
                .append('g')
                .attr('class', 'legendParts')
                .attr('transform', 'translate(' + (+margin.left) + ',' + margin.top + ')');

            legendParts.exit().remove();

            var legendCircles = legendParts.selectAll('.legendCircle').data(function (d) {
                return [d]
            });

            legendCircles.enter().append('svg:circle')
                .attr('class', 'legendCircle')
                .attr('cx', '0')
                .attr('cy', function (d) {
                    return legendScale(d.name);
                })
                .attr('fill', function (d) {
                    return barColors(d.name)
                })
                .attr('r', 10);

            legendCircles.attr('fill', function (d) {
                return barColors(d.name)
            });

            legendCircles.exit().remove();

            var legendText = legendParts.selectAll('.legendText').data(function (d) {
                return [d]
            });

            legendText.enter()
                .append('svg:text')
                .attr('class', 'legendText')
                .attr('x', '15')
                .attr('y', function (d) {
                    return legendScale(d.name) + 5
                })
                .text(function (d) {
                    return d.value
                });

            legendText.text(function (d) {
                return d.value
            });

            legendText.exit().remove();
        }

        function drawLineChart(svgId, dataset, xName, yName, showPointers) {
            //scales
            var height = +$("#" + svgId).height();
            var width = +$("#" + svgId).width();
            var widthDiff = width - margin.right - margin.left - 100;
            var heightDiff = height - margin.bottom;
            var xScale = d3.scale.ordinal().range([0, widthDiff]);
            //xScale.ticks(d3.time.month, 1);
            var yScale = d3.scale.linear().range([height - margin.top - margin.bottom, 0]);
            //create axis
            var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.time.format("%b %y"));
            var yAxis = d3.svg.axis().scale(yScale).orient("left");

            //draw averages
            var line = d3.svg.line().x(function (d) {
                    return xScale(d.date);
                })
                .y(function (d) {
                    return yScale(d.value);
                });

            var keys = d3.keys(dataset[0]).filter(function (key) {
                return key !== "date";
            });

            lineColors.domain(keys);

            var transformedDataset = lineColors.domain().map(function (name) {
                return {
                    name: name,
                    values: dataset.map(function (d) {
                        return {
                            date: d.date,
                            value: +d[name],
                            name: name
                        };
                    })
                };
            });

            var totalMonths = (toDate.getFullYear() - fromDate.getFullYear() ) * 12 + Math.abs(toDate.getMonth() - fromDate.getMonth());
            var start=d3.time.month.floor(fromDate);
            var end =d3.time.month.ceil(toDate);
            var months = (totalMonths == 0) ? d3.time.months(start, end) : d3.time.months(start,end);

            xScale.domain(months);
            yScale.domain([d3.min(transformedDataset, function (c) {
                    return d3.min(c.values, function (v) {
                        return v.value;
                    });
                }),
                   d3.max(transformedDataset, function (c) {
                    return d3.max(c.values, function (v) {
                        return v.value;
                    });
                })]);
            
            // Draw line. 
            var svg = d3.select("#" + svgId);

            var yLabel = svg.selectAll('.yLabel');
            if (yLabel.empty())
                svg.append('text')
                .attr("class", "yLabel axisLabels")
                .text(yName)
                .attr('transform', 'translate(' + (+margin.left / 5) + ',' + (+heightDiff) + ') rotate(-90)');

            var xLabel = svg.selectAll('.xLabel');
            if (xLabel.empty())
                svg.append('text')
                .attr("class", "xLabel axisLabels")
                .text(xName)
                .attr('transform', 'translate(' + (+widthDiff + 100) + ',' + (+height - margin.bottom) + ')');

            var xAxisGroup = svg.select('.x.axis');
            if (xAxisGroup.empty())
                xAxisGroup = svg.append("svg:g")
                .attr('class', 'x axis')
                .attr('transform', 'translate(' + margin.left + ',' + heightDiff + ')')

            svg.select('.x.axis').call(xAxis);

            var yAxisGroup = svg.select('.y.axis');
            if (yAxisGroup.empty())
                yAxisGroup = svg.append('svg:g')
                .attr("class", "y axis")
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

            svg.select('.y.axis').call(yAxis);

            var lineGroups = svg.selectAll(".LineGroup").data(transformedDataset);

            lineGroups.enter()
                .append('g')
                .attr('class', 'LineGroup');

            lineGroups.exit().remove();

            var lines = lineGroups.selectAll('.line').data(function (d) {
                return [d]
            });

            lines.enter().append("svg:path")
                .attr("class", "line")
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
                .attr("d", function (d) {
                    return line(d.values);
                })
                .style("stroke", function (d) {
                    return lineColors(d.name);
                })
                .on('mouseover', function (event) {
                    var selectedGraphs = $('.line').not(this);
                    d3.selectAll(selectedGraphs).style("opacity", 0.2);
                    $(this).css("stroke-width", '6px');
                    if(showPointers)
                      $(this).css("cursor", 'pointer');
                })
                .on('mouseout', function (event) {
                    var selectedGraphs = $('.line').not(this);
                    d3.selectAll(selectedGraphs).style("opacity", 1);
                    $(this).css("stroke-width", '1.5px');
                    if(showPointers)
                      $(this).css("cursor", 'default');
                });

            lines.attr("class", "line")
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
                .attr("d", function (d) {
                    return line(d.values);
                })
                .style("stroke", function (d) {
                    return lineColors(d.name);
                });

            lines.exit().remove();

            var datapoints = lineGroups.selectAll('.datapoints').data(transformedDataset);

            datapoints.enter()
                .append("g")
                .attr("class", "datapoints")
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
                .style("stroke", function (d) {
                    return lineColors(d.name);
                })

            datapoints.style("stroke", function (d) {
                return lineColors(d.name);
            })

            datapoints.exit().remove();

            var circles = datapoints.selectAll(".datapoint").data(function (d) {
                return (d.values);
            })

            circles.enter()
                .append("svg:circle")
                .attr("class", "datapoint")
                .attr("cx", function (d, i) {
                    return xScale(d.date)
                })
                .attr("cy", function (d, i) {
                    return yScale(d.value)
                })
                .attr("r", 2)
                .attr("title", maketip);

            circles.attr("cx", function (d, i) {
                return xScale(d.date)
            })
                .attr("cy", function (d, i) {
                    return yScale(d.value)
                })
                .attr('title', maketip)
                .attr("r", 2);

            circles.exit().remove();

            $('circle').tipsy({
                opacity: .9,
                gravity: 'w',
                html: true
            });

            var legend = svg.selectAll('.legend').data(keys);

            var legendScale = d3.scale.ordinal().range([0, 25, 50, 75]).domain(keys);
            var legendEnter = legend.enter()
                .append('svg:g')
                .attr('class', 'legend')
                .attr('transform', 'translate(' + (+widthDiff + 100) + ',' + margin.top + ')')

            legendEnter.append('svg:circle')
                .attr('cx', '0')
                .attr('cy', function (d) {
                    return legendScale(d);
                })
                .attr('r', 10)
                .attr('fill', function (d) {
                    return lineColors(d);
                })

            legendEnter.append('svg:text')
                .attr('x', '15')
                .attr('y', function (d) {
                    return legendScale(d) + 5
                })
                .text(function (d) {
                    return d
                });
        }

        function drawPerformanceIndex() {
            drawLineChart('perfIndChart', perfData, "Months", "Performance Index",false);
        }

        /*Utility Functions*/

        function toProperCase(s) {
            s = $.trim(s);
            return s.toLowerCase()
                .replace(/\b((m)(a?c))?(\w)/g,
                    function ($1, $2, $3, $4, $5) {
                        if ($2) {
                            return $3.toUpperCase() + $4 + $5.toUpperCase();
                        }
                        return $1.toUpperCase();
                    }
                );
        }

        function getFirstIndexOf(array, property, value) {
            var index = -1,
                data;
            for (var i = 0; i < array.length; i++) {
                //assuming only two fields for now
                if (property.indexOf(".") != -1) {
                    var fields = property.split('.');
                    data = array[i][fields[0]][fields[1]]
                } else {
                    data = array[i][property];
                }
                if (data == value) {
                    index = i;
                    break;
                }
            }
            return index;
        }

        function scrollToDiv(el) {
            $('html, body').animate({
                scrollTop: $(el).offset().top
            }, 750);
        }

    </script>
</body>

</html>