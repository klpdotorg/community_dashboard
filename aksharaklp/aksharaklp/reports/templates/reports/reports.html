<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="" name="description">
  <meta content="" name="author">
  <link href="../../assets/ico/favicon.ico" rel="shortcut icon">
  <title>Community Feedback</title>
  <!-- Bootstrap core CSS -->
  <link href="../../static/lib/bootstrap.min.css" rel="stylesheet">
  <link href="../../static/lib/tipsy.css" rel="stylesheet">
  <link href="../../static/lib/datepicker.css" rel="stylesheet">
  <link href="../../static/css/dashboard.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
  <div id="header" class="navbar navbar-default navbar-fixed-top">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menuDiv">
        <span class="sr-only">Toggle navigation</span>
        <span class="glyphicon glyphicon-edit"></span>
      </button>
      <a class="navbar-brand" href="#">Karnataka Learning Program</a>
    </div>
    <div class="collapse navbar-collapse navbar-left" id="menuDiv">
      <ul id="dropdownsList" class="nav navbar-nav">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">District <b class="caret"></b></a>
          <ul id="dSelect" class="dropdown-menu">
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Block <b class="caret"></b></a>
          <ul id="bSelect" class="dropdown-menu">
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Cluster <b class="caret"></b></a>
          <ul id="cSelect" class="dropdown-menu">
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">School <b class="caret"></b></a>
          <ul id="sSelect" class="dropdown-menu">
          </ul>
        </li>
        <li class="navbar-form">
          <div class="input-group">
            <span class="input-group-addon" style="width:40px">From</span>
            <input id="fromDatePicker" type="text" readonly="readonly" class="form-control" style="cursor:pointer">
          </div>
        </li>
        <li class="navbar-form">
          <div class="input-group">
            <span class="input-group-addon" style="width:40px">To</span>
            <input id="toDatePicker" type="text" readonly="readonly" class="form-control dateinput" style="cursor:pointer">
          </div>
        </li>
        <li>
          <button id="submitBtn" type="submit" class="btn btn-default navbar-btn" onclick="refreshCharts()">Go</button>
        <li>
      </ul>
    </div>
  </div>
  <!-- /container -->
  <div id="container" class="container-fluid">
    <ul id="tabs" class="nav nav-tabs">
      <li class="active"><a href="#requirementsDiv" data-toggle="tab">Requirements Metrics</a>
      </li>
      <li><a href="#performanceDiv" data-toggle="tab">Performance Index</a>
      </li>
    </ul>
    <div class="tab-content">
      <div id="requirementsDiv" class="tab-pane fade in active">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12">
              <h5>Requirements Of Parents, SDMC, Community Members And Teachers Based On The Feeddback Survey</h5>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div style="height:300px">
                <svg id="reqAvgChart" style="width:100%;height:100%">
                </svg>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h5>Percentage of <span id="selectedSHName"></span> satisfied across the 4 requirements</h5>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div style="height:300px">
                <svg id="reqAvgBreakdownChart" style="width:100%;height:100%">
                </svg>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div style="height:200px">
                <svg id="reqAvgBreakdownLegend" style="width:100%;height:100%">
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="performanceDiv" class="tab-pane fade">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12">
              <h5>Performance Index Of Parents, SDMC, Community Members And Teachers Based On The Feeddback Survey</h5>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div style="height:500px">
                <svg id="perfIndChart" style="width:100%;height:100%"></svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Bootstrap core JavaScript
      ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="../../static/lib/jquery-min.js"></script>
  <script src="../../static/lib/jquery.tipsy.js"></script>
  <script src="../../static/lib/bootstrap.min.js"></script>
  <script src="../../static/lib/bootstrap-datepicker.js"></script>
  <script src="../../static/lib/d3.min.js"></script>
  <script type="text/javascript">
 var locationData={% autoescape off %}  {{ locationData }} {% endautoescape %};
 var reqBasicData,reqSplitData,perfData;
 var toDate,fromDate;
 var linesPalette=['#EC6608','#8E8CA5','#6398E5','#2C3E50'];
 var barsPalette=['#3891E3','#24B2B6','#7575BC','#CB0012'];
 var fromDate, toDate;
 var drawPending=true;
 var margin = { top: +10, right: +70, left: +60, bottom: +40 };
  //tips
  //defines a function to be used to append the title to the tooltip.  you can set how you want it to display here.
  var maketip = function (d) { 
    var tip = "(" + Math.round(+d.value *1000)/1000 + " , " +parseDate(d.date) +")"; return tip;};
 //parse date
 var parseDate=d3.time.format("%b %y");
 //palette
 var barColors = d3.scale.ordinal().range(barsPalette);
 var lineColors = d3.scale.ordinal().range(linesPalette);
 var reqSplitLegendData={
    Teachers:[{name:'split1',value:'TLM (Teaching learning material) Sufficient'}, {name:'split2',value:'Overloaded with work'}, {name:'split3',value:'Need retraining/extra classes'}, {name:'split4',value:'Healthy relationship with the board'}],
    Parents:[{name:'split1',value:'School Board running the school efficiently'}, {name:'split2',value:'Teachers are consistent and take classes regularly'},
     {name:'split3',value:'Children getting required attention in school'}, {name:'split4',value:'Concern pertaining to the food served in school'}],
    Community:[{name:'split1',value:'Teachers qualified/trained or motivated'}, {name:'split2',value:'Student-Teacher ratio is high'},
     {name:'split3',value:"Government involved in school's development"}, {name:'split4',value:'Is the school in a safe location and is the infrastructure good?'}]
     }; 
 
  //performance Index
  //requirements metrics
  jQuery(document)
    .ready(function () {
      $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
       var target=$(e.target).attr('href');
       if(drawPending===true)
        {
         if(target=="#requirementsDiv")
            drawReqChart();
          else
            drawPerformanceIndex();  
        }
        drawPending=false;
      })

      for (var key in locationData) {
        locationData[key] = JSON.parse(locationData[key]);
        var data = $.extend(true, {}, locationData[key][0]);
        data.pk = 0;
        for (name in data.fields) {
          if (name.search('name') != -1)
            data.fields[name] = "All"
          else data.fields[name] = 0
        }
        locationData[key].unshift(data);
      }
      setLocationData(0);
      setDateDropDowns();
      $('#submitBtn').trigger('click');
    });

  function setLocationData(pk) {
    var selectedValue = { pk: pk };
    onSelect("dSelect", locationData.districts, null, "district_name", selectedValue, onDistrictSelect, onDistrictSelect);
  }

  function onDistrictSelect(selectedValue) {
    onSelect("bSelect", locationData.blocks, "district", "block_name", selectedValue, onBlockSelect, onBlockSelect);
  }

  function onBlockSelect(selectedValue) {
    onSelect("cSelect", locationData.clusters, "block", "cluster_name", selectedValue, onClusterSelect, onClusterSelect);
  }

  function onClusterSelect(selectedValue) {
    onSelect("sSelect", locationData.schools, "cluster", "school_name", selectedValue, onSchoolSelect, onSchoolSelect);
  }

  function onSchoolSelect(selectedValue) {}

  function onSelect(dropdownId, rawData, filterKey, dataField, selectedValue, eventListener) {
    selectedValue = (selectedValue.data != null) ? selectedValue.data : selectedValue;
    jQuery('#' + dropdownId)
      .empty();
    var fk = selectedValue.pk;
    var filteredData, selDistIndex;
    if (filterKey != null) {
      filteredData = jQuery.grep(rawData, function (el, index) {
        var value = (el.fields[filterKey] != null) ? el.fields[filterKey] : el[filterKey];
        return value == fk || value == 0;
      });
      selDistIndex = getFirstIndexOf(filteredData, "fields." + filterKey, fk);
    } else {
      filteredData = rawData;
      selDistIndex = 0;
    }
    var selAnchor;
    jQuery.each(filteredData, function (index, value) {
      var selText = toProperCase(value.fields[dataField]);
      var anchor = $('<a>')
        .attr('href', 'javascript:void(0)')
        .append(selText)
        .click(value, eventListener)
        .click(function (event) {
          var list = event.target;
          $(list)
            .parents('.dropdown')
            .children('.dropdown-toggle')
            .html($(list)
              .text() + ' <span class="caret"></span>');
        });
      var createdList = jQuery('#' + dropdownId)
        .append($('<li>')
          .append($(anchor)));
      selAnchor = (selDistIndex == index) ? anchor : selAnchor;
    });
    $(selAnchor)
      .trigger('click');
  }

  function setDateDropDowns() {
      $('#fromDatePicker').datepicker({ format: "MM - yyyy", minViewMode: 1, autoclose: true });
      $('#toDatePicker').datepicker({ format: "MM - yyyy", minViewMode: 1, autoclose: true });
      $('#fromDatePicker').datepicker("setDate", new Date(2008,3,01) );
      $('#toDatePicker').datepicker("setDate", new Date(2008,9,01) );
  }

  //Chart Functions
  //generate data
  function refreshCharts()
  {
    fromDate = $("#fromDatePicker").datepicker('getDate');
    toDate = $("#toDatePicker").datepicker('getDate');
    //transfer Data
    generateData();
    //set refresh boolean
    drawPending=true;
    if($(".nav-tabs li.active a").attr('href')=="#requirementsDiv"){
       drawReqChart();
       scrollToDiv("body");
     }
    else
      drawPerformanceIndex();
  }

  function drawReqChart()
  {
    drawLineChart("reqAvgChart",reqBasicData,"Months","Requirements Metric");
    var svg = d3.select("#reqAvgChart");
    var lines=svg.selectAll('.line');
    lines.on('click',function(data){
      $('#selectedSHName').text(data.name);
      drawReqSplitsChart(data.name);
      scrollToDiv('#selectedSHName');
    });
    $('#selectedSHName').text("Teachers");
    drawReqSplitsChart();
  }

  function drawReqSplitsChart(splitOf) {
    splitOf = (splitOf != null) ? splitOf : "Teachers";
    var height = +jQuery("#reqAvgChart").height();
    var width = +jQuery("#reqAvgChart").width();
    var heightDiff=height-margin.top-margin.bottom;
    var widthDiff = width - margin.right - margin.left - 100;
    var padding=.1,outerPadding=0;

    //filter data
    var dataset = reqSplitData;
    dataset = dataset.filter(function (datum) { return (datum.splitOf == splitOf) });
    
    //date axis      
    var dateScale = d3.scale.ordinal().rangeRoundBands([0, widthDiff],padding,outerPadding);
    var splitScale = d3.scale.ordinal();
    var yScale = d3.scale.linear().range([heightDiff, 0]);

    var xAxis = d3.svg.axis()
                      .scale(dateScale)
                      .orient("bottom")
                      .tickFormat(d3.time.format("%b %y"))
    
    var yAxis = d3.svg.axis()
      .scale(yScale)
      .orient("left");
    
    var svg = d3.select("#reqAvgBreakdownChart");

    var yLabel=svg.selectAll('.yLabel');
    if(yLabel.empty())
       svg.append('text')
          .attr("class", "yLabel axisLabels")
          .text("Requirement Metric(%)")
          .attr('transform','translate('+(+margin.left/5)+','+(+heightDiff)+') rotate(-90)');


    var xLabel=svg.selectAll('.xLabel');
     if(xLabel.empty())
        svg.append('text')
           .attr("class", "xLabel axisLabels")
           .text("Months")
           .attr('transform','translate('+(+widthDiff+100)+','+(+height-margin.bottom)+')');

    var splits = d3.keys(dataset[0])
      .filter(function (key) {
        return key !== 'splitOf' && key !== 'date' && key!='splitData'; 
      });
    
    barColors.domain(splits);
    dataset.forEach(function (d, i) { d.splitData = splits.map(function (name) { return { name: name, value: +d[name] }; }); });
   
    var months=d3.time.months(fromDate, d3.time.month.offset(toDate,1));
    dateScale.domain(months);
    splitScale.domain(splits).rangeRoundBands([0, dateScale.rangeBand()]);
    
    yScale.domain([d3.min(dataset, function (d) { return d3.min(d.splitData, function (d) { return d.value; }); }), 
                   d3.max(dataset, function (d) { return d3.max(d.splitData, function (d) { return d.value; }); })]);
    
    var xAxisGroup=svg.select(".x.axis");
    if(xAxisGroup.empty())
    {
      xAxisGroup=svg.append("g").attr("class", "x axis")
                    .attr("transform", "translate("+margin.left+"," +(+margin.top+heightDiff)+ ")")   
    }
    xAxisGroup.call(xAxis);
    
    var yAxisGroup=svg.select(".y.axis");
    if(yAxisGroup.empty())
    {
      yAxisGroup=svg.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate("+margin.left+","+margin.top+")")
    }
    yAxisGroup.call(yAxis);
    
    var perfSplit = svg.selectAll(".PerfSplit").data(dataset);

    perfSplit.exit().remove();

    perfSplit.enter()
      .append("g")
      .attr("class", "PerfSplit")
      .attr("transform", function (d) {return "translate(" + dateScale(d.date) + ",0)"; });

    perfSplit.attr("class", "PerfSplit")
             .attr("transform", function (d) {return "translate(" +   dateScale(d.date) + ",0)"; });

    var rects=perfSplit.selectAll(".bar").data(function (d) { return d.splitData; });

    rects.exit().remove();
    
    rects.enter()
         .append("svg:rect")
         .attr("class","bar")
         .attr("width", splitScale.rangeBand())
         .attr("height", function (d) { return heightDiff-yScale(d.value); })
         .attr("y", function (d) { return yScale(d.value)})
         .attr("x", function (d) { return splitScale(d.name); })
         .style("fill", function (d) { return barColors(d.name); })
         .attr("transform", function (d) {return "translate("+margin.left+","+(+margin.top)+")"; });

    rects.attr("width", splitScale.rangeBand())
         .attr("height", function (d) { return heightDiff-yScale(d.value); })
         .attr("x", function (d) { return splitScale(d.name); })
         .attr("y", function (d) { return yScale(d.value)})
         .style("fill", function (d) { return barColors(d.name); })
         .attr("transform", function (d) {return "translate("+margin.left+","+margin.top+")"; });

    
    var leftMargin=splitScale.rangeBand()/2+margin.left;

    var tipsFunction=function(d){ return Math.round(d.value*1000)/1000};

    var circles=perfSplit.selectAll('.trendPoint').data(function(d){return d.splitData});
    
    circles.enter().append('svg:circle')
           .attr('class','trendPoint')
           .attr('cy', function (d) { return yScale(d.value); })
           .attr('cx', function (d) { return splitScale(d.name); })
           .attr('r',2)
           .attr('title',tipsFunction)
           .attr("transform", function (d) {return "translate("+leftMargin+","+margin.top+")"; })
           
    circles.attr('cy', function (d) { return yScale(d.value); })
           .attr('cx', function (d) { return splitScale(d.name); })
           .attr('r',3)
           .attr('title',tipsFunction)
           .attr("transform", function (d) {return "translate("+leftMargin+","+margin.top+")"; })
           
    circles.exit().remove();        

    $('.trendPoint').tipsy({opacity:.9, gravity:'w'});

    var line = d3.svg.line().x(function (d) { return splitScale(d.name); })
                             .y(function (d) { return yScale(d.value); });
    
    var lines = perfSplit.selectAll(".trendLine").data(function(d){return [d]});

    lines.enter().append("svg:path")
        .attr("class", "trendLine")
        .attr("d", function (d) { return line(d.splitData); })
        .attr('transform', 'translate(' + leftMargin + ','+margin.top+')')
        .on('mouseover',function(event){
             var bars = $('.bar'); 
             d3.selectAll(bars).style("opacity",0.2);
        })
        .on('mouseout',function(event){ 
          var bars = $('.bar'); 
          d3.selectAll(bars).style("opacity",1);
        });
    lines.attr("d", function (d) { return line(d.splitData); })
         .attr('transform', 'translate(' + leftMargin + ','+margin.top+')');
        
    lines.exit().remove();

    var legendScale=d3.scale.ordinal().range([25,50,75,100]).domain(splits);

    var legendSvg=d3.select('#reqAvgBreakdownLegend');

    var legendParts=legendSvg.selectAll('.legendParts').data(reqSplitLegendData[splitOf]);

    legendParts.enter()
               .append('g')
               .attr('class','legendParts')
               .attr('transform','translate('+(+margin.left)+','+margin.top+')');
    
    legendParts.exit().remove();

    var legendCircles=legendParts.selectAll('.legendCircle').data(function(d){return [d]});

    legendCircles.enter().append('svg:circle')
            .attr('class','legendCircle')
            .attr('cx','0')
            .attr('cy',function(d){return legendScale(d.name);})
            .attr('fill',function(d){return barColors(d.name)})
            .attr('r',10);

    legendCircles.attr('fill',function(d){return barColors(d.name)});

    legendCircles.exit().remove();

    var legendText=legendParts.selectAll('.legendText').data(function(d){
      return [d]});

    legendText.enter()
              .append('svg:text')
              .attr('class','legendText')
              .attr('x','15')
              .attr('y',function(d){return legendScale(d.name)+5})
              .text(function(d){return d.value});

    legendText.text(function(d){return d.value});

    legendText.exit().remove();
  }
  
  function drawLineChart(svgId,dataset,xName,yName) {
    //scales
    var height = +jQuery("#"+svgId).height();
    var width = +jQuery("#"+svgId).width();
    var widthDiff = width - margin.right - margin.left-100;
    var heightDiff = height -margin.bottom;
    var xScale = d3.time.scale().range([0, widthDiff]);
    xScale.ticks(d3.time.month,1);
    var yScale = d3.scale.linear().range([height - margin.top - margin.bottom,0]);
    //create axis
    var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
    var yAxis = d3.svg.axis().scale(yScale).orient("left");
    //draw averages
    var line = d3.svg.line().x(function (d) { return xScale(d.date); })
                             .y(function (d) { return yScale(d.value); });

    var fakeLine=d3.svg.line().x(function (d) { return xScale(d.date); })
                             .y(function (d) { return heightDiff; });

    var keys=d3.keys(dataset[0]).filter(function (key) {
        return key !== "date";
    });

    lineColors.domain(keys);
    
    var transformedDataset = lineColors.domain().map(function (name) { 
      return { name: name, values: dataset.map(function (d) { 
        return { date: d.date, value: +d[name] }; }) };
      });
    
    xScale.domain(d3.extent(dataset, function (d) { return d.date;}));

    yScale.domain([d3.min(transformedDataset, function (c) { return d3.min(c.values, function (v) { return v.value; }); }),
                   d3.max(transformedDataset, function (c) { return d3.max(c.values, function (v) { return v.value; }); }) ]);
    // Draw line. 
    var svg = d3.select("#"+svgId);
    
    var yLabel=svg.selectAll('.yLabel');
    if(yLabel.empty())
       svg.append('text')
          .attr("class", "yLabel axisLabels")
          .text(yName)
          .attr('transform','translate('+(+margin.left/5)+','+(+heightDiff)+') rotate(-90)');


    var xLabel=svg.selectAll('.xLabel');
     if(xLabel.empty())
        svg.append('text')
           .attr("class", "xLabel axisLabels")
           .text(xName)
           .attr('transform','translate('+(+widthDiff+100)+','+(+height-margin.bottom)+')');

    var xAxisGroup =svg.select('.x.axis');
    if(xAxisGroup.empty())
      xAxisGroup=svg.append("svg:g")
                    .attr('class', 'x axis')
                    .attr('transform', 'translate(' + margin.left + ',' +heightDiff  + ')')
        
    svg.select('.x.axis').call(xAxis);
    
    var yAxisGroup = svg.select('.y.axis');
    if(yAxisGroup.empty())
      yAxisGroup=svg.append('svg:g')
                    .attr("class", "y axis")
                    .attr('transform', 'translate(' + margin.left + ','+margin.top+')');

    svg.select('.y.axis').call(yAxis);

    var lineGroups = svg.selectAll(".LineGroup").data(transformedDataset);

    lineGroups.enter()
              .append('g')
              .attr('class','LineGroup');

    lineGroups.exit().remove();

    var lines=lineGroups.selectAll('.line').data(function(d){return [d]});

    lines.enter().append("svg:path")
        .attr("class", "line")
        .attr('transform', 'translate(' + margin.left + ','+margin.top+')')
        .attr("d", function (d) { return line(d.values); })
        .style("stroke", function (d) { return lineColors(d.name);})
        .on('mouseover',function(event){
             var selectedGraphs = $('.line').not(this); 
             d3.selectAll(selectedGraphs).style("opacity",0.2);
             $(this).css("stroke-width",'6px');
        })
        .on('mouseout',function(event){ 
          var selectedGraphs = $('.line').not(this); 
          d3.selectAll(selectedGraphs).style("opacity",1);
          $(this).css("stroke-width",'1.5px');
        });

    lines.attr("class", "line")
        .attr('transform', 'translate(' + margin.left + ','+margin.top+')')
        .attr("d", function (d) { return line(d.values); })
        .style("stroke", function (d) { return lineColors(d.name);});
    
    lines.exit().remove();

    var datapoints = lineGroups.selectAll('.datapoints').data(transformedDataset);

    datapoints.enter()
              .append("g")
              .attr("class", "datapoints")
              .attr('transform', 'translate(' + margin.left + ','+margin.top+')') 
              .style("stroke", function (d) { return lineColors(d.name); })

    datapoints.style("stroke", function (d) { return lineColors(d.name); })
              
    datapoints.exit().remove();

    var circles=datapoints.selectAll(".datapoint").data(function (d) { return (d.values); })
    
    circles.enter()
           .append("svg:circle")
           .attr("class", "datapoint")
           .attr("cx", function (d, i) { return xScale(d.date) })
           .attr("cy", function (d, i) { return yScale(d.value)  })
           .attr("r", 2)
           .attr ("title", maketip);

    circles.attr("cx", function (d, i) { return xScale(d.date) })
           .attr("cy", function (d, i) { return yScale(d.value)  })
           .attr('title',maketip)
           .attr("r", 2);

    circles.exit().remove();

    $('circle').tipsy({opacity:.9, gravity:'w', html:true});

    var legend=svg.selectAll('.legend').data(keys);
    
    var legendScale=d3.scale.ordinal().range([0,25,50,75]).domain(keys);
    var legendEnter=legend.enter()
                          .append('svg:g')
                          .attr('class','legend')
                          .attr('transform','translate('+(+widthDiff+100)+','+margin.top+')')
            
    legendEnter.append('svg:circle')
            .attr('cx','0')
            .attr('cy',function(d){return legendScale(d);})
            .attr('r',10)
            .attr('fill', function(d){ return lineColors(d); })
            
    legendEnter.append('svg:text')
               .attr('x','15')
               .attr('y',function(d){return legendScale(d)+5})
               .text(function(d){return d});
  }

  function drawPerformanceIndex() {
    drawLineChart('perfIndChart',perfData,"Months","Performance Index");
  }


  function generateData()
  {
    generateReqData();
    generateReqSplitData();
    generatePerfData();
  }

  function generateReqData() {
     var data = "date,Teachers,Parents,Community";
     var startDate = +fromDate;
     var endDate = +d3.time.month.offset(toDate, 1);
     var dateArray = d3.time.months(startDate, endDate);
     for (var i = 0; i < dateArray.length; i++) {
       var date = +dateArray[i];
       var line = date + "," + Math.random() + "," + Math.random() + "," + Math.random();
       data = data + '\n' + line;
    }
    reqBasicData= d3.csv.parse(data, function (d) {
      return {
        date: new Date(+d.date),
        Teachers: +d.Teachers,
        Parents: +d.Parents,
        Community: +d.Community
      };
    });

  }

  function generateReqSplitData(startDate, endDate) {
    var data = "date,splitOf,split1,split2,split3,split4";
    var startDate = +fromDate;
    var endDate = +d3.time.month.offset(toDate, 1);
    var dateArray = d3.time.months(startDate, endDate);
     for (var i = 0; i < dateArray.length; i++) {
       var date = +dateArray[i];
       var line1 = date + "," + "Teachers," + Math.random()*100 + "," + Math.random()*100 + "," + Math.random()*100 + "," + Math.random()*100;
       var line2 = date + "," + "Parents," + Math.random()*100 + "," + Math.random()*100 + "," + Math.random()*100 + "," + Math.random()*100;
       var line3 = date + "," + "Community,"+ Math.random()*100 + "," + Math.random()*100 + "," + Math.random()*100 + "," + Math.random()*100;
       data = data + '\n' + line1;
       data = data + '\n' + line2;
       data = data + '\n' + line3;
     }
     avgsSplitData = d3.csv.parse(data, function (d) {
       return {
         date: new Date(+d.date),
         splitOf: d.splitOf,
         split1: +d.split1,
         split2: +d.split2,
         split3: +d.split3,
         split4: +d.split4
       };
     });
    reqSplitData = avgsSplitData;
  }

  function generatePerfData(startDate,endDate){
    var data="date,Teachers,SDMC,Community,Parents";
    var startDate = +fromDate;
    var endDate = +d3.time.month.offset(toDate, 1);
    var dateArray = d3.time.months(startDate, endDate);
    for (var i = 0; i < dateArray.length; i++) {
      var date = +dateArray[i];
      var line = date + "," + Math.random() + "," + Math.random() + "," + Math.random()+","+Math.random();
      data = data + '\n' + line;
    }

    perfData=d3.csv.parse(data, function (d) {
      return {
        date: new Date(+d.date),
        Teachers: +d.Teachers,
        SDMC: +d.SDMC,
        Community: +d.Community,
        Parents: +d.Parents
      };
    });
  }

  /*Utility Functions*/

  function toProperCase(s) {
    s = jQuery.trim(s);
    return s.toLowerCase()
      .replace(/\b((m)(a?c))?(\w)/g,
        function ($1, $2, $3, $4, $5) {
          if ($2) {
            return $3.toUpperCase() + $4 + $5.toUpperCase();
          }
          return $1.toUpperCase();
        }
      );
  }

  function getFirstIndexOf(array, property, value) {
    var index = -1,
      data;
    for (var i = 0; i < array.length; i++) {
      //assuming only two fields for now
      if (property.indexOf(".") != -1) {
        var fields = property.split('.');
        data = array[i][fields[0]][fields[1]]
      } else {
        data = array[i][property];
      }
      if (data == value) {
        index = i;
        break;
      }
    }
    return index;
  }

  function scrollToDiv(el)
  {
    $('html, body').animate({ scrollTop: $(el).offset().top}, 750);
  }
  </script>
</body>

</html>